import*as w from"../forwarded@0.2.0/index.js";import*as P from"../ipaddr.js@1.9.1/index.js";function A(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function c(e){if(e.__esModule)return e;var r=e.default;if(typeof r=="function"){var t=function n(){return this instanceof n?Reflect.construct(r,arguments,this.constructor):r.apply(this,arguments)};t.prototype=r.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}),t}var s={exports:{}},_=c(w),b=c(P);s.exports=x;var I=s.exports.all=h,k=s.exports.compile=y,M=_,v=b,O=/^[0-9]+$/,p=v.isValid,f=v.parse,g={linklocal:["169.254.0.0/16","fe80::/10"],loopback:["127.0.0.1/8","::1/128"],uniquelocal:["10.0.0.0/8","172.16.0.0/12","192.168.0.0/16","fc00::/7"]};function h(e,r){var t=M(e);if(!r)return t;typeof r!="function"&&(r=y(r));for(var n=0;n<t.length-1;n++)r(t[n],n)||(t.length=n+1);return t}function y(e){if(!e)throw new TypeError("argument is required");var r;if(typeof e=="string")r=[e];else if(Array.isArray(e))r=e.slice();else throw new TypeError("unsupported trust argument");for(var t=0;t<r.length;t++)e=r[t],Object.prototype.hasOwnProperty.call(g,e)&&(e=g[e],r.splice.apply(r,[t,1].concat(e)),t+=e.length-1);return E(j(r))}function j(e){for(var r=new Array(e.length),t=0;t<e.length;t++)r[t]=T(e[t]);return r}function E(e){var r=e.length;return r===0?F:r===1?N(e[0]):D(e)}function T(e){var r=e.lastIndexOf("/"),t=r!==-1?e.substring(0,r):e;if(!p(t))throw new TypeError("invalid IP address: "+t);var n=f(t);r===-1&&n.kind()==="ipv6"&&n.isIPv4MappedAddress()&&(n=n.toIPv4Address());var o=n.kind()==="ipv6"?128:32,i=r!==-1?e.substring(r+1,e.length):null;if(i===null?i=o:O.test(i)?i=parseInt(i,10):n.kind()==="ipv4"&&p(i)?i=q(i):i=null,i<=0||i>o)throw new TypeError("invalid range on address: "+e);return[n,i]}function q(e){var r=f(e),t=r.kind();return t==="ipv4"?r.prefixLengthFromSubnetMask():null}function x(e,r){if(!e)throw new TypeError("req argument is required");if(!r)throw new TypeError("trust argument is required");var t=h(e,r),n=t[t.length-1];return n}function F(){return!1}function D(e){return function(r){if(!p(r))return!1;for(var t=f(r),n,o=t.kind(),i=0;i<e.length;i++){var u=e[i],a=u[0],d=a.kind(),m=u[1],l=t;if(o!==d){if(d==="ipv4"&&!t.isIPv4MappedAddress())continue;n||(n=d==="ipv4"?t.toIPv4Address():t.toIPv4MappedAddress()),l=n}if(l.match(a,m))return!0}return!1}}function N(e){var r=e[0],t=r.kind(),n=t==="ipv4",o=e[1];return function(i){if(!p(i))return!1;var u=f(i),a=u.kind();if(a!==t){if(n&&!u.isIPv4MappedAddress())return!1;u=n?u.toIPv4Address():u.toIPv4MappedAddress()}return u.match(r,o)}}var $=s.exports,C=A($);export{I as all,k as compile,C as default};
