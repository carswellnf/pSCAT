import*as p from"../ee-first@1.1.1/index.js";function d(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function y(e){if(e.__esModule)return e;var n=e.default;if(typeof n=="function"){var t=function r(){return this instanceof r?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};t.prototype=n.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var o=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,o.get?o:{enumerable:!0,get:function(){return e[r]}})}),t}var c={exports:{}},h=y(p);c.exports=_;var m=c.exports.isFinished=l,a=q(),f=h,v=typeof setImmediate=="function"?setImmediate:function(e){process.nextTick(e.bind.apply(e,arguments))};function _(e,n){return l(e)!==!1?(v(n,null,e),e):(g(e,O(n)),e)}function l(e){var n=e.socket;if(typeof e.finished=="boolean")return!!(e.finished||n&&!n.writable);if(typeof e.complete=="boolean")return!!(e.upgrade||!n||!n.readable||e.complete&&!e.readable)}function b(e,n){var t,r,o=!1;function s(i){t.cancel(),r.cancel(),o=!0,n(i)}t=r=f([[e,"end","finish"]],s);function u(i){e.removeListener("socket",u),!o&&t===r&&(r=f([[i,"error","close"]],s))}if(e.socket){u(e.socket);return}e.on("socket",u),e.socket===void 0&&k(e,u)}function g(e,n){var t=e.__onFinished;(!t||!t.queue)&&(t=e.__onFinished=F(e),b(e,t)),t.queue.push(n)}function F(e){function n(t){if(e.__onFinished===n&&(e.__onFinished=null),!!n.queue){var r=n.queue;n.queue=null;for(var o=0;o<r.length;o++)r[o](t,e)}}return n.queue=[],n}function k(e,n){var t=e.assignSocket;typeof t=="function"&&(e.assignSocket=function(r){t.call(this,r),n(r)})}function q(){try{return require("async_hooks")}catch{return{}}}function O(e){var n;return a.AsyncResource&&(n=new a.AsyncResource(e.name||"bound-anonymous-fn")),!n||!n.runInAsyncScope?e:n.runInAsyncScope.bind(n,e,null)}var j=c.exports,w=d(j);export{w as default,m as isFinished};
